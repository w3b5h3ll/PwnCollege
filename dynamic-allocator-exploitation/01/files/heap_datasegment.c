#include <malloc.h>
#include <string.h>
#include <unistd.h>
#include <sys/sendfile.h>
#include <fcntl.h>

char msg[] = "About to malloc!";
int main(int argc, char **argv)
{
    write(1, msg, strlen(msg));
    char buffer[4096];
    sendfile(1, open("./flag", 0), NULL, 2048);

    // sendfile(1, open("/proc/self/maps", 0), NULL, 2048);
    ssize_t bytes_read = read(open("/proc/self/maps", 0), buffer, sizeof(buffer));
    ssize_t bytes_written = write(1, buffer, bytes_read);

    malloc(16);

    // printf("malloc 256")
    bytes_read = read(open("/proc/self/maps", 0), buffer, sizeof(buffer));
    bytes_written = write(1, buffer, bytes_read);

    // sendfile(1, open("/proc/self/maps", 0), NULL, 2048);

    write(1, msg, strlen(msg));
    malloc(0x1000);
    malloc(0x10000);
    // malloc(1024);

    // expand
    malloc(0x10000);
    malloc(0x10000);
    malloc(0x10000);
    malloc(0x10000);
    return 0;
}